<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" lang="ru">
<head>
  <title th:text="${isEdit} ? 'Редактировать клиента' : 'Добавить клиента'">Редактировать клиента</title>
  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  <style>
    .main-content {
      margin-bottom: 100px;
      padding-top: 20px;
    }
    .form-card {
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
      border-radius: 15px;
    }
    .required {
      color: red;
    }
  </style>
</head>
<body>

<div th:replace="general :: page-header"></div>

<div class="main-content">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="card form-card">
          <div class="card-header bg-primary text-white">
            <h4 class="mb-0" th:text="${isEdit} ? 'Редактировать клиента' : 'Добавить нового клиента'"></h4>
          </div>
          <div class="card-body p-4">
            <form method="post" action="/saveClient" id="clientForm">
              <input type="hidden" name="clientId" th:value="${client.id}" th:if="${isEdit}">

              <!-- Personal Information -->
              <div class="row">
                <div class="col-12">
                  <h5 class="mb-3">Персональная информация</h5>
                </div>
              </div>

              <div class="form-group">
                <label for="fullName">Полное имя <span class="required">*</span></label>
                <input type="text" class="form-control" id="fullName" name="fullName"
                       th:value="${client.fullName}" required maxlength="100"
                       placeholder="Введите полное имя клиента">
                <div class="invalid-feedback">
                  Пожалуйста, введите полное имя клиента.
                </div>
              </div>

              <!-- Contact Information -->
              <div class="row">
                <div class="col-12">
                  <h5 class="mb-3">Контактная информация</h5>
                </div>
              </div>

              <div class="row">
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email"
                           th:value="${client.email}" maxlength="100"
                           placeholder="example@email.com">
                    <div class="invalid-feedback">
                      Пожалуйста, введите корректный email адрес.
                    </div>
                  </div>
                </div>
                <div class="col-md-6">
                  <div class="form-group">
                    <label for="phone">Телефон</label>
                    <input type="tel" class="form-control" id="phone" name="phone"
                           th:value="${client.phone}" maxlength="20"
                           placeholder="+7 (999) 999-99-99">
                    <div class="invalid-feedback">
                      Пожалуйста, введите корректный номер телефона.
                    </div>
                  </div>
                </div>
              </div>

              <div class="form-group">
                <label for="address">Адрес</label>
                <textarea class="form-control" id="address" name="address" rows="3"
                          th:text="${client.address}"
                          placeholder="Введите полный адрес клиента"></textarea>
              </div>

              <!-- Miles Information -->
              <div class="row">
                <div class="col-12">
                  <h5 class="mb-3">Бонусная программа</h5>
                </div>
              </div>

              <div class="form-group">
                <label for="bonusMiles">Бонусные мили</label>
                <input type="number" class="form-control" id="bonusMiles" name="bonusMiles"
                       th:value="${client.bonusMiles}" min="0" max="1000000"
                       placeholder="0">
                <small class="form-text text-muted">
                  Текущее количество бонусных миль клиента. VIP статус при 10,000+ милях.
                </small>
                <div class="invalid-feedback">
                  Количество миль должно быть неотрицательным числом.
                </div>
              </div>

              <!-- Preview VIP status -->
              <div id="vipPreview" class="alert alert-warning" style="display: none;">
                <i class="fas fa-crown"></i>
                <strong>VIP статус</strong> - клиент получит VIP статус с этим количеством миль!
              </div>

              <!-- Action buttons -->
              <div class="form-group text-center mt-4">
                <button type="submit" class="btn btn-success btn-lg mr-3">
                  <i class="fas fa-save"></i>
                  <span th:text="${isEdit} ? 'Сохранить изменения' : 'Создать клиента'"></span>
                </button>
                <a th:href="${isEdit} ? '/client?clientId=' + ${client.id} : '/clients'"
                   class="btn btn-secondary btn-lg">
                  <i class="fas fa-times"></i> Отмена
                </a>
              </div>
            </form>
          </div>
        </div>

        <!-- Help Card -->
        <div class="card mt-4">
          <div class="card-body">
            <h6 class="card-title">Справка</h6>
            <ul class="mb-0 small">
              <li>Поля, отмеченные звездочкой (<span class="required">*</span>), обязательны для заполнения</li>
              <li>Email должен быть уникальным в системе</li>
              <li>VIP статус автоматически присваивается клиентам с 10,000+ бонусными милями</li>
              <li>Телефон может быть в любом формате</li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<div th:replace="general :: site-footer"></div>

<!-- Font Awesome for icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

<div th:replace="general :: site-script"></div>

<script>
  // Form validation
  (function() {
    'use strict';
    window.addEventListener('load', function() {
      const forms = document.getElementsByClassName('needs-validation');
      const validation = Array.prototype.filter.call(forms, function(form) {
        form.addEventListener('submit', function(event) {
          if (form.checkValidity() === false) {
            event.preventDefault();
            event.stopPropagation();
          }
          form.classList.add('was-validated');
        }, false);
      });
    }, false);
  })();

  // Phone number formatting
  document.getElementById('phone').addEventListener('input', function(e) {
    let value = e.target.value.replace(/\D/g, '');
    if (value.startsWith('7')) {
      value = '+7 ' + value.slice(1);
    } else if (value.startsWith('8')) {
      value = '+7 ' + value.slice(1);
    }
    if (value.length > 3) {
      value = value.slice(0, 3) + ' (' + value.slice(3, 6) + ') ' +
              value.slice(6, 9) + '-' + value.slice(9, 11) + '-' + value.slice(11, 13);
    }
    e.target.value = value;
  });

  // VIP status preview
  document.getElementById('bonusMiles').addEventListener('input', function(e) {
    const miles = parseInt(e.target.value) || 0;
    const vipPreview = document.getElementById('vipPreview');

    if (miles >= 10000) {
      vipPreview.style.display = 'block';
    } else {
      vipPreview.style.display = 'none';
    }
  });

  // Trigger VIP preview on page load
  document.addEventListener('DOMContentLoaded', function() {
    const milesInput = document.getElementById('bonusMiles');
    if (milesInput.value) {
      milesInput.dispatchEvent(new Event('input'));
    }
  });
</script>

</body>
</html>